name: Google Jules AI Reviewer

on:
  pull_request_target:
    types: [opened, synchronize]

jobs:
  review:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4
        with:
          repository: ${{ github.event.pull_request.head.repo.full_name }}
          ref: ${{ github.event.pull_request.head.ref }}

      - name: Jules AI Reviewer
        uses: google-labs-code/jules-action@v1.0.0
        with:
          jules_api_key: ${{ secrets.JULES_API_KEY }}
          prompt: |
            You are Google Jules, an expert senior software engineer and code reviewer.
            
            Your task is to review this Pull Request for the "Arch Viz" project.
            
            Instructions:
            1. Analyze the changes against the guidelines in `AGENTS.md`.
            2. If you find ANY issues (bugs, missing tests, code style violations), YOU MUST FIX THEM. Apply changes directly to this branch.
            3. Once the code is correct (or if it was already correct), SUBMIT a GitHub Review with the status "APPROVE".
            4. If you cannot fix the issues, request changes with detailed comments.
            
            Goal: Make the PR merge-ready automatically.
